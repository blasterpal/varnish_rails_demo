Varnish up and running.
--------------------------        

http://varnish.projects.linpro.no/wiki/Introduction 
http://varnish.projects.linpro.no/wiki/VCL

vcl_recv() Called after a request is received from the browser, but before it is processed.    
vcl_fetch() Called when the request has been sent to the backend and a response has been received from the backend.


For a cache hit, X-Varnish will contain both the ID of the current request and the ID of the request that populated the cache. It makes debugging Varnish a lot easier. 

**What is varnish:
	HTTP/Caching (not reverse proxy) for dynamic pages. 
	"an accelerator for incoming traffic.We actually claim that Varnish is ten to twenty times faster than the popular Squid cache on the same kind of hardware!" 
	
**Setup:
  -L cache size

**Custom Headers and backend headers 
	Rails uses private HTTP headers, won't work. But if not cached sent to client.                      

**Identifying cacheable objects: 
	This is a business decision. Can come back to it after your ruleset is working and matching objects.
	Which uris?
	How long to cache?            
	How much data is cachable? (crawl with Wget to obtain ballpark for -L size)           
	
	Default VCL/config:
	
	Varnish rightly behaves very conservatively about what it can cache and what it can't.
	
**VCL, the Varnish language for caching:
	"VCL programs are transparantly compiled to executable
	machine code and therefore run at full CPU speed when executed"
	backend
	Understanding Varnish default subroutines.
	
	                                                    
	Improving vcl_error to give more info. Example:
	                                                          
	
	
	
	


**Purging Objects

**Cookies and Page Fragments

**ESI and Akamai

**Testing:
	Test/Unit script to verify cached pages are cached after 2-3 requests.


**Deploying/Configuration:
	Rake and cap task examples to purge upon deploy.
	Daemon Options  

**Gotchas/Tips:
POSIX regex 
Error 200  for debugging rules.
Caching can expose other bottlenecks and issues. Case in point the Apache mod_proxy Friday.
Double quotes only in regex comparisons!             

FYI: https://portal.primedia.com/wiki/railsteam/Page_Caching_AG 


: don't put space before argument parentheses
** TERM signal received.



